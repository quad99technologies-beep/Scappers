# North Macedonia Scraper Runbook

This is the single source of truth for the North Macedonia drug register scraper.

## Pipeline at a glance
- Steps (run via `python scripts/North Macedonia/run_pipeline_resume.py`):
  0. Backup & DB init (`00_backup_and_clean.py`)
  1. Collect URLs (`01_collect_urls.py`) - gather drug register page URLs
  2. Scrape details (`02_scrape_details.py`) - extract drug registration data
  3. Scrape zdravstvo (`03_scrape_zdravstvo.py`) - get max price data from zdravstvo.gov.mk
  3a. Scrape max prices parallel (`03a_scrape_maxprices_parallel.py`) - parallel price extraction
- Resume-safe: checkpoints stored by `core.pipeline_checkpoint`.

## Prereqs
- Env: `config/NorthMacedonia.env.json` (loaded by `config_loader.py`).
- DB: PostgreSQL reachable per env; schema auto-migrates on step 0.
- Chrome: Required for Selenium-based scraping.

## How to run
```bash
cd "scripts/North Macedonia"
python run_pipeline_resume.py --fresh   # full run
# or resume from a step
python run_pipeline_resume.py --step 3  # start at zdravstvo prices
```

## Outputs
- DB tables (prefix `nm_`): drug_register, max_prices, final_output, pcid_mappings, step_progress, export_reports, errors.
- Files:
  - Exports generated by the final pipeline step.

## Health check
```bash
cd "scripts/North Macedonia"
python health_check.py
```
Checks DB connectivity, URL reachability, disk space, and Chrome availability.

## Common issues
- zdravstvo.gov.mk rate limiting: the scraper uses polite delays; if blocked, increase delays in config.
- Chrome not found: ensure Chrome is installed and chromedriver is on PATH.
- Stale checkpoint: use `--fresh` to clear and restart.
